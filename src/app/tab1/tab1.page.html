<!--
  Tab 1: Basic Calculator
  - Header includes a Settings button that opens the settings modal
  - Card contains the canvas display and a text fallback (always visible)
  - Keypad buttons delegate to CalculatorService via handlers in tab1.page.ts
-->
<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      Calculator
    </ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="openSettings()">
        <ion-icon name="settings-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-card>
    <ion-card-content>
      <app-display-canvas></app-display-canvas>
      <!-- Text fallback so users always see current input/result,
           even if Canvas cannot render on a given platform -->
      <div class="text-display">
        <div class="expr">{{ (calc.expression$ | async) || '\u00A0' }}</div>
        <div class="res">{{ (calc.result$ | async) || '0' }}</div>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Basic keypad: numeric and basic ops -->
  <ion-grid class="keypad">
    <ion-row>
      <ion-col size="3"><ion-button expand="block" color="medium" (click)="onClear()">C</ion-button></ion-col>
      <ion-col size="3"><ion-button expand="block" color="medium" (click)="onBack()">⌫</ion-button></ion-col>
      <ion-col size="3"><ion-button expand="block" color="medium" (click)="onOp('%')">%</ion-button></ion-col>
      <ion-col size="3"><ion-button expand="block" (click)="onOp('/')">÷</ion-button></ion-col>
    </ion-row>
    <ion-row>
      <ion-col size="3"><ion-button expand="block" (click)="onDigit('7')">7</ion-button></ion-col>
      <ion-col size="3"><ion-button expand="block" (click)="onDigit('8')">8</ion-button></ion-col>
      <ion-col size="3"><ion-button expand="block" (click)="onDigit('9')">9</ion-button></ion-col>
      <ion-col size="3"><ion-button expand="block" (click)="onOp('*')">×</ion-button></ion-col>
    </ion-row>
    <ion-row>
      <ion-col size="3"><ion-button expand="block" (click)="onDigit('4')">4</ion-button></ion-col>
      <ion-col size="3"><ion-button expand="block" (click)="onDigit('5')">5</ion-button></ion-col>
      <ion-col size="3"><ion-button expand="block" (click)="onDigit('6')">6</ion-button></ion-col>
      <ion-col size="3"><ion-button expand="block" (click)="onOp('-')">−</ion-button></ion-col>
    </ion-row>
    <ion-row>
      <ion-col size="3"><ion-button expand="block" (click)="onDigit('1')">1</ion-button></ion-col>
      <ion-col size="3"><ion-button expand="block" (click)="onDigit('2')">2</ion-button></ion-col>
      <ion-col size="3"><ion-button expand="block" (click)="onDigit('3')">3</ion-button></ion-col>
      <ion-col size="3"><ion-button expand="block" (click)="onOp('+')">+</ion-button></ion-col>
    </ion-row>
    <ion-row>
      <ion-col size="6"><ion-button expand="block" (click)="onDigit('0')">0</ion-button></ion-col>
      <ion-col size="3"><ion-button expand="block" (click)="onDot()">.</ion-button></ion-col>
      <ion-col size="3"><ion-button expand="block" color="success" (click)="onEquals()">=</ion-button></ion-col>
    </ion-row>
  </ion-grid>

  <!-- Settings modal is controlled by the settingsOpen flag in the page class -->
  <ion-modal [isOpen]="settingsOpen" (didDismiss)="settingsOpen=false">
    <ng-template>
      <app-settings-modal (close)="settingsOpen=false"></app-settings-modal>
    </ng-template>
  </ion-modal>
</ion-content>
